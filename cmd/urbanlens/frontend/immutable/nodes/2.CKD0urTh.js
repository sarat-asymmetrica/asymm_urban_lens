import{b as Re,d as ls,f as $,a as T,c as cs}from"../chunks/fJyebq4Z.js";import{i as vs}from"../chunks/dDdm_xNy.js";import{d as ge,h as x,g as oe,c as Ee,I as Ae,b as fs,v as p,ax as ds,K as us,L as ps,M as Oe,s as ye,e as se,C as ze,ar as hs,ac as Le,f as ee,j as Ne,k as ms,aK as Fe,ap as Ue,aL as gs,a4 as xe,R as le,aM as _s,aN as ws,aO as bs,aP as F,r as qe,p as Be,aQ as Ie,P as Ss,a as Ye,aR as ks,ao as Es,i as ys,B as te,_ as Is,aS as Cs,as as Ts,am as $s,aT as As,aI as Ke,o as V,O as Ns,aU as Ds,z as Je,aV as Xe,V as Y,aW as Ge,G as k,E as w,F as _,D as Qe,A as Ze,aX as me,aY as Us,ad as Ce,N as Ms,aZ as Rs}from"../chunks/Dyi_coXj.js";import{h as Os}from"../chunks/BvkkVqa6.js";import{d as Ls,w as we,o as xs,a as Hs}from"../chunks/BuaMBcls.js";import{s as _e,e as X}from"../chunks/WjSgu_mB.js";import{s as ae,a as je,i as Q,b as He}from"../chunks/DMohf0AL.js";function Vs(e,s){return s}function Ws(e,s,a){for(var i=[],f=s.length,l,r=s.length,v=0;v<f;v++){let h=s[v];Be(h,()=>{if(l){if(l.pending.delete(h),l.done.add(h),l.pending.size===0){var m=e.outrogroups;De(Ue(l.done)),m.delete(l),m.size===0&&(e.outrogroups=null)}}else r-=1},!1)}if(r===0){var t=i.length===0&&a!==null;if(t){var c=a,o=c.parentNode;Es(o),o.append(c),e.items.clear()}De(s,!t)}else l={pending:new Set(s),done:new Set},(e.outrogroups??=new Set).add(l)}function De(e,s=!0){for(var a=0;a<e.length;a++)ys(e[a],s)}var Ve;function es(e,s,a,i,f,l=null){var r=e,v=new Map,t=(s&Fe)!==0;if(t){var c=e;r=x?ge(oe(c)):c.appendChild(Ee())}x&&Ae();var o=null,h=ds(()=>{var d=a();return gs(d)?d:d==null?[]:Ue(d)}),m,g=!0;function E(){n.fallback=o,Ps(n,m,r,s,i),o!==null&&(m.length===0?(o.f&F)===0?qe(o):(o.f^=F,ie(o,null,r)):Be(o,()=>{o=null}))}var I=fs(()=>{m=p(h);var d=m.length;let A=!1;if(x){var O=us(r)===ps;O!==(d===0)&&(r=Oe(),ge(r),ye(!1),A=!0)}for(var y=new Set,N=ee,U=ms(),b=0;b<d;b+=1){x&&se.nodeType===ze&&se.data===hs&&(r=se,A=!0,ye(!1));var D=m[b],H=i(D,b),S=g?null:v.get(H);S?(S.v&&Le(S.v,D),S.i&&Le(S.i,b),U&&N.skipped_effects.delete(S.e)):(S=zs(v,g?r:Ve??=Ee(),D,H,b,f,s,a),g||(S.e.f|=F),v.set(H,S)),y.add(H)}if(d===0&&l&&!o&&(g?o=Ne(()=>l(r)):(o=Ne(()=>l(Ve??=Ee())),o.f|=F)),x&&d>0&&ge(Oe()),!g)if(U){for(const[ne,C]of v)y.has(ne)||N.skipped_effects.add(C.e);N.oncommit(E),N.ondiscard(()=>{})}else E();A&&ye(!0),p(h)}),n={effect:I,items:v,outrogroups:null,fallback:o};g=!1,x&&(r=se)}function Ps(e,s,a,i,f){var l=(i&ks)!==0,r=s.length,v=e.items,t=e.effect.first,c,o=null,h,m=[],g=[],E,I,n,d;if(l)for(d=0;d<r;d+=1)E=s[d],I=f(E,d),n=v.get(I).e,(n.f&F)===0&&(n.nodes?.a?.measure(),(h??=new Set).add(n));for(d=0;d<r;d+=1){if(E=s[d],I=f(E,d),n=v.get(I).e,e.outrogroups!==null)for(const S of e.outrogroups)S.pending.delete(n),S.done.delete(n);if((n.f&F)!==0)if(n.f^=F,n===t)ie(n,null,a);else{var A=o?o.next:t;n===e.effect.last&&(e.effect.last=n.prev),n.prev&&(n.prev.next=n.next),n.next&&(n.next.prev=n.prev),B(e,o,n),B(e,n,A),ie(n,A,a),o=n,m=[],g=[],t=o.next;continue}if((n.f&Ie)!==0&&(qe(n),l&&(n.nodes?.a?.unfix(),(h??=new Set).delete(n))),n!==t){if(c!==void 0&&c.has(n)){if(m.length<g.length){var O=g[0],y;o=O.prev;var N=m[0],U=m[m.length-1];for(y=0;y<m.length;y+=1)ie(m[y],O,a);for(y=0;y<g.length;y+=1)c.delete(g[y]);B(e,N.prev,U.next),B(e,o,N),B(e,U,O),t=O,o=U,d-=1,m=[],g=[]}else c.delete(n),ie(n,t,a),B(e,n.prev,n.next),B(e,n,o===null?e.effect.first:o.next),B(e,o,n),o=n;continue}for(m=[],g=[];t!==null&&t!==n;)(c??=new Set).add(t),g.push(t),t=t.next;if(t===null)continue}(n.f&F)===0&&m.push(n),o=n,t=n.next}if(e.outrogroups!==null){for(const S of e.outrogroups)S.pending.size===0&&(De(Ue(S.done)),e.outrogroups?.delete(S));e.outrogroups.size===0&&(e.outrogroups=null)}if(t!==null||c!==void 0){var b=[];if(c!==void 0)for(n of c)(n.f&Ie)===0&&b.push(n);for(;t!==null;)(t.f&Ie)===0&&t!==e.fallback&&b.push(t),t=t.next;var D=b.length;if(D>0){var H=(i&Fe)!==0&&r===0?a:null;if(l){for(d=0;d<D;d+=1)b[d].nodes?.a?.measure();for(d=0;d<D;d+=1)b[d].nodes?.a?.fix()}Ws(e,b,H)}}l&&Ss(()=>{if(h!==void 0)for(n of h)n.nodes?.a?.apply()})}function zs(e,s,a,i,f,l,r,v){var t=(r&ws)!==0?(r&bs)===0?le(a,!1,!1):xe(a):null,c=(r&_s)!==0?xe(f):null;return{v:t,i:c,e:Ne(()=>(l(s,t??a,c??f,v),()=>{e.delete(i)}))}}function ie(e,s,a){if(e.nodes)for(var i=e.nodes.start,f=e.nodes.end,l=s&&(s.f&F)===0?s.nodes.start:a;i!==null;){var r=Ye(i);if(l.before(i),i===f)return;i=r}}function B(e,s,a){s===null?e.effect.first=a:s.next=a,a===null?e.effect.last=s:a.prev=s}function We(e,s,a=!1,i=!1,f=!1){var l=e,r="";te(()=>{var v=Is;if(r===(r=s()??"")){x&&Ae();return}if(v.nodes!==null&&(Cs(v.nodes.start,v.nodes.end),v.nodes=null),r!==""){if(x){se.data;for(var t=Ae(),c=t;t!==null&&(t.nodeType!==ze||t.data!=="");)c=t,t=Ye(t);if(t===null)throw Ts(),$s;Re(se,c),l=ge(t);return}var o=r+"";a?o=`<svg>${o}</svg>`:i&&(o=`<math>${o}</math>`);var h=ls(o);if((a||i)&&(h=oe(h)),Re(oe(h),h.lastChild),a||i)for(;oe(h);)l.before(oe(h));else l.before(h)}})}const Pe=[...` 	
\r\f¬†\v\uFEFF`];function Fs(e,s,a){var i=e==null?"":""+e;if(a){for(var f in a)if(a[f])i=i?i+" "+f:f;else if(i.length)for(var l=f.length,r=0;(r=i.indexOf(f,r))>=0;){var v=r+l;(r===0||Pe.includes(i[r-1]))&&(v===i.length||Pe.includes(i[v]))?i=(r===0?"":i.substring(0,r))+i.substring(v+1):r=v}}return i===""?null:i}function ce(e,s,a,i,f,l){var r=e.__className;if(x||r!==a||r===void 0){var v=Fs(a,i,l);(!x||v!==e.getAttribute("class"))&&(v==null?e.removeAttribute("class"):e.className=v),e.__className=a}else if(l&&f!==l)for(var t in l){var c=!!l[t];(f==null||c!==!!f[t])&&e.classList.toggle(t,c)}return l}function qs(e,s,a=s){var i=new WeakSet;As(e,"input",async f=>{var l=f?e.defaultValue:e.value;if(l=Te(e)?$e(l):l,a(l),ee!==null&&i.add(ee),await Ke(),l!==(l=s())){var r=e.selectionStart,v=e.selectionEnd,t=e.value.length;if(e.value=l??"",v!==null){var c=e.value.length;r===v&&v===t&&c>t?(e.selectionStart=c,e.selectionEnd=c):(e.selectionStart=r,e.selectionEnd=Math.min(v,c))}}}),(x&&e.defaultValue!==e.value||V(s)==null&&e.value)&&(a(Te(e)?$e(e.value):e.value),ee!==null&&i.add(ee)),Ns(()=>{var f=s();if(e===document.activeElement){var l=Ds??ee;if(i.has(l))return}Te(e)&&f===$e(e.value)||e.type==="date"&&!f&&!e.value||f!==e.value&&(e.value=f??"")})}function Te(e){var s=e.type;return s==="number"||s==="range"}function $e(e){return e===""?null:+e}const G=we("disconnected"),ve=we("intake"),j=we(""),fe=we([]);let R=null,Z=null;function ss(e="ws://localhost:8080/ws"){if(R?.readyState===WebSocket.OPEN){console.log("WebSocket already connected");return}G.set("connecting");try{R=new WebSocket(e),R.onopen=()=>{console.log("‚úÖ Connected to UrbanLens"),G.set("connected"),Z&&(clearTimeout(Z),Z=null)},R.onmessage=s=>{try{const a=JSON.parse(s.data);Bs(a)}catch(a){console.error("Failed to parse message:",a)}},R.onerror=s=>{console.error("WebSocket error:",s),G.set("error")},R.onclose=()=>{console.log("WebSocket closed, will reconnect..."),G.set("disconnected"),Z=window.setTimeout(()=>{ss(e)},2e3)}}catch(s){console.error("Failed to connect:",s),G.set("error")}}function Bs(e){switch(e.type){case"phase_update":e.phase&&ve.set(e.phase);break;case"thinking":case"response":e.content&&j.update(s=>s+e.content);break;case"complete":j.update(s=>{const a=s;return fe.update(i=>[...i,{id:crypto.randomUUID(),role:"assistant",content:a,timestamp:new Date,phase:e.phase,isStreaming:!1}]),""}),ve.set("complete");break;case"error":console.error("Error from server:",e.content),fe.update(s=>[...s,{id:crypto.randomUUID(),role:"assistant",content:`Error: ${e.content}`,timestamp:new Date,isStreaming:!1}]),j.set("");break}}function Ys(e){if(!R||R.readyState!==WebSocket.OPEN){console.error("WebSocket not connected");return}fe.update(a=>[...a,{id:crypto.randomUUID(),role:"user",content:e,timestamp:new Date}]);const s={type:"query",input:e,timestamp:new Date().toISOString()};R.send(JSON.stringify(s)),j.set(""),ve.set("intake")}function Ks(){R&&(R.close(),R=null),Z&&(clearTimeout(Z),Z=null),G.set("disconnected")}function Js(){fe.set([]),j.set(""),ve.set("intake")}const as=Ls(j,e=>e.length>0);var Xs=$('<span class="check svelte-2s0mg1">‚úì</span>'),Gs=$('<span class="spinner svelte-2s0mg1"></span>'),Qs=$('<span class="number svelte-2s0mg1"></span>'),Zs=$("<div></div>"),js=$('<div><div class="step-circle svelte-2s0mg1"><!></div> <div class="step-content svelte-2s0mg1"><div class="step-label svelte-2s0mg1"> </div> <div class="step-description svelte-2s0mg1"> </div></div> <!></div>'),ea=$('<div><div class="phase-header svelte-2s0mg1"><div class="thinking-indicator svelte-2s0mg1"><span class="pulse svelte-2s0mg1"></span> <span class="text svelte-2s0mg1">Thinking...</span></div></div> <div class="phase-steps svelte-2s0mg1"></div></div>');function sa(e,s){Je(s,!1);const a=()=>ae(ve,"$currentPhase",f),i=()=>ae(as,"$isStreaming",f),[f,l]=je(),r=le(),v=[{name:"intake",label:"Intake",description:"Understanding your question"},{name:"analysis",label:"Analysis",description:"Examining data and patterns"},{name:"synthesis",label:"Synthesis",description:"Connecting insights"},{name:"insight",label:"Insight",description:"Formulating response"}];function t(m){return v.findIndex(g=>g.name===m)}Xe(()=>a(),()=>{Y(r,t(a()))}),Ge();var c=ea();let o;var h=k(w(c),2);es(h,5,()=>v,Vs,(m,g,E)=>{var I=js();let n;var d=w(I),A=w(d);{var O=C=>{var W=Xs();T(C,W)},y=C=>{var W=cs(),K=Ze(W);{var P=u=>{var L=Gs();T(u,L)},de=u=>{var L=Qs();L.textContent=E+1,T(u,L)};Q(K,u=>{E===p(r)&&i()?u(P):u(de,!1)},!0)}T(C,W)};Q(A,C=>{E<p(r)?C(O):C(y,!1)})}_(d);var N=k(d,2),U=w(N),b=w(U,!0);_(U);var D=k(U,2),H=w(D,!0);_(D),_(N);var S=k(N,2);{var ne=C=>{var W=Zs();let K;te(()=>K=ce(W,1,"step-connector svelte-2s0mg1",null,K,{active:E<p(r)})),T(C,W)};Q(S,C=>{V(()=>E<v.length-1)&&C(ne)})}_(I),te(()=>{n=ce(I,1,"step svelte-2s0mg1",null,n,{active:E===p(r)&&i(),complete:E<p(r)}),_e(b,(p(g),V(()=>p(g).label))),_e(H,(p(g),V(()=>p(g).description)))}),T(m,I)}),_(h),_(c),te(()=>o=ce(c,1,"reasoning-phase svelte-2s0mg1",null,o,{active:i()})),T(e,c),Qe(),l()}var aa=$('<div class="welcome svelte-o2sewt"><div class="welcome-icon svelte-o2sewt">üèôÔ∏è</div> <h2 class="svelte-o2sewt">Welcome to Urban Lens</h2> <p class="svelte-o2sewt">Ask me anything about urban research, census data, surveys, or spatial analysis.</p> <div class="example-queries svelte-o2sewt"><button class="svelte-o2sewt">Enhance census data</button> <button class="svelte-o2sewt">Validate survey</button> <button class="svelte-o2sewt">Spatial analysis</button></div></div>'),ta=$('<span class="icon svelte-o2sewt">üë§</span> <span class="label svelte-o2sewt">You</span>',1),na=$('<span class="icon svelte-o2sewt">üî¨</span> <span class="label svelte-o2sewt">Urban Lens</span>',1),ra=$('<div><div class="message-role svelte-o2sewt"><!></div> <div class="message-content svelte-o2sewt"><!></div> <div class="message-timestamp svelte-o2sewt"> </div></div>'),oa=$('<div class="message assistant streaming svelte-o2sewt"><div class="message-role svelte-o2sewt"><span class="icon svelte-o2sewt">üî¨</span> <span class="label svelte-o2sewt">Urban Lens</span></div> <div class="message-content svelte-o2sewt"><!> <span class="cursor svelte-o2sewt">‚ñä</span></div></div>'),ia=$("<!> <!>",1),la=$('<div class="chat-interface svelte-o2sewt"><div class="chat-header svelte-o2sewt"><div class="header-content svelte-o2sewt"><h1 class="svelte-o2sewt">Urban Lens</h1> <p class="subtitle svelte-o2sewt">Research Intelligence for Urban Informatics</p></div> <div class="header-status svelte-o2sewt"><div><span class="dot svelte-o2sewt"></span> <span class="text svelte-o2sewt"> </span></div> <button class="btn-clear svelte-o2sewt" title="Clear conversation"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" class="svelte-o2sewt"><path d="M3 4h10M5 4V3a1 1 0 011-1h4a1 1 0 011 1v1m1 0v9a1 1 0 01-1 1H5a1 1 0 01-1-1V4h8z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" class="svelte-o2sewt"></path></svg></button></div></div> <div class="messages-container svelte-o2sewt"><div class="messages svelte-o2sewt"><!></div></div> <!> <div class="input-area svelte-o2sewt"><textarea placeholder="Ask about urban research, census data, surveys..." rows="1" class="svelte-o2sewt"></textarea> <button class="btn-send svelte-o2sewt" title="Send message"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" class="svelte-o2sewt"><path d="M18 2L9 11M18 2l-6 16-3-7-7-3 16-6z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svelte-o2sewt"></path></svg></button></div></div>');function ca(e,s){Je(s,!1);const a=()=>ae(fe,"$conversations",r),i=()=>ae(j,"$streamingContent",r),f=()=>ae(G,"$connectionStatus",r),l=()=>ae(as,"$isStreaming",r),[r,v]=je();let t=le(""),c=le(),o=le();xs(()=>{ss(),p(o)?.focus()}),Hs(()=>{Ks()});function h(){const u=p(t).trim();u&&(Ys(u),Y(t,""),p(o)&&me(o,p(o).style.height="auto"))}function m(u){u.key==="Enter"&&!u.shiftKey&&(u.preventDefault(),h())}function g(){p(o)&&(me(o,p(o).style.height="auto"),me(o,p(o).style.height=p(o).scrollHeight+"px"))}function E(u){return u.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"})}Xe(()=>(a(),i(),p(c)),()=>{(a()||i())&&Ke().then(()=>{p(c)&&me(c,p(c).scrollTop=p(c).scrollHeight)})}),Ge(),vs();var I=la(),n=w(I),d=k(w(n),2),A=w(d);let O;var y=k(w(A),2),N=w(y,!0);_(y),_(A);var U=k(A,2);_(d),_(n);var b=k(n,2),D=w(b),H=w(D);{var S=u=>{var L=aa(),re=k(w(L),6),ue=w(re),pe=k(ue,2),z=k(pe,2);_(re),_(L),X("click",ue,()=>Y(t,"How can I enhance census data for Bangalore?")),X("click",pe,()=>Y(t,"Validate survey responses against codebook")),X("click",z,()=>Y(t,"Analyze spatial clusters in city data")),T(u,L)},ne=u=>{var L=ia(),re=Ze(L);es(re,1,a,z=>z.id,(z,M)=>{var J=ra();let he;var be=w(J),ts=w(be);{var ns=q=>{var ke=ta();Ce(2),T(q,ke)},rs=q=>{var ke=na();Ce(2),T(q,ke)};Q(ts,q=>{p(M),V(()=>p(M).role==="user")?q(ns):q(rs,!1)})}_(be);var Se=k(be,2),os=w(Se);We(os,()=>(p(M),V(()=>p(M).content.replace(/\n/g,"<br/>")))),_(Se);var Me=k(Se,2),is=w(Me,!0);_(Me),_(J),te(q=>{he=ce(J,1,"message svelte-o2sewt",null,he,{user:p(M).role==="user",assistant:p(M).role==="assistant"}),_e(is,q)},[()=>(p(M),V(()=>E(p(M).timestamp)))]),T(z,J)});var ue=k(re,2);{var pe=z=>{var M=oa(),J=k(w(M),2),he=w(J);We(he,()=>(i(),V(()=>i().replace(/\n/g,"<br/>")))),Ce(2),_(J),_(M),T(z,M)};Q(ue,z=>{l()&&z(pe)})}T(u,L)};Q(H,u=>{a(),V(()=>a().length===0)?u(S):u(ne,!1)})}_(D),_(b),He(b,u=>Y(c,u),()=>p(c));var C=k(b,2);{var W=u=>{sa(u,{})};Q(C,u=>{l()&&u(W)})}var K=k(C,2),P=w(K);Us(P),He(P,u=>Y(o,u),()=>p(o));var de=k(P,2);_(K),_(I),te(u=>{O=ce(A,1,"status-indicator svelte-o2sewt",null,O,{connected:f()==="connected"}),_e(N,f()),P.disabled=f()!=="connected",de.disabled=u},[()=>(p(t),f(),V(()=>!p(t).trim()||f()!=="connected"))]),X("click",U,function(...u){Js?.apply(this,u)}),qs(P,()=>p(t),u=>Y(t,u)),X("keydown",P,m),X("input",P,g),X("click",de,h),T(e,I),Qe(),v()}var va=$('<meta name="description" content="Urban Lens: Conversational AI for Urban Research"/>');function _a(e){Os("1uha8ag",s=>{var a=va();Ms(()=>{Rs.title="Urban Lens - Research Intelligence"}),T(s,a)}),ca(e,{})}export{_a as component};
